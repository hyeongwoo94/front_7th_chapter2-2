# ë‹¨ê³„ 7: í™•ì¥ Hook & HOC - í•™ìŠµ ë‚´ìš©

ì´ ë¬¸ì„œëŠ” ë‹¨ê³„ 7ì—ì„œ í•™ìŠµí•´ì•¼ í•  í•µì‹¬ ê°œë…ê³¼ êµ¬í˜„ ë‚´ìš©ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ“š í•µì‹¬ ê°œë…

### 1. ë©”ëª¨ì´ì œì´ì…˜ (Memoization)

ë©”ëª¨ì´ì œì´ì…˜ì€ ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥í•˜ì—¬ ë™ì¼í•œ ì…ë ¥ì— ëŒ€í•´ ì¬ê³„ì‚°ì„ ë°©ì§€í•˜ëŠ” ê¸°ë²•ì…ë‹ˆë‹¤.

**ëª©ì **:
- ë¶ˆí•„ìš”í•œ ì¬ê³„ì‚° ë°©ì§€
- ì„±ëŠ¥ ìµœì í™”
- ì°¸ì¡° ì•ˆì •ì„± ìœ ì§€

**ì‚¬ìš© ì‚¬ë¡€**:
- `useMemo`: ê°’ ë©”ëª¨ì´ì œì´ì…˜
- `useCallback`: í•¨ìˆ˜ ë©”ëª¨ì´ì œì´ì…˜
- `memo`: ì»´í¬ë„ŒíŠ¸ ë©”ëª¨ì´ì œì´ì…˜

### 2. useRef

`useRef`ëŠ” ë¦¬ë Œë”ë§ ì—†ì´ ê°’ì„ ìœ ì§€í•˜ëŠ” í›…ì…ë‹ˆë‹¤.

**íŠ¹ì§•**:
- `.current` ì†ì„±ìœ¼ë¡œ ê°’ ì ‘ê·¼
- ê°’ ë³€ê²½ ì‹œ ë¦¬ë Œë”ë§ ì•ˆ í•¨
- DOM ì°¸ì¡°ë‚˜ ì´ì „ ê°’ ì €ì¥ì— ì‚¬ìš©

### 3. HOC (Higher-Order Component)

HOCëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ë°›ì•„ì„œ ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

**ëª©ì **:
- ì»´í¬ë„ŒíŠ¸ ì¬ì‚¬ìš©ì„± í–¥ìƒ
- ê³µí†µ ë¡œì§ ë¶„ë¦¬
- ì„±ëŠ¥ ìµœì í™”

**ì˜ˆì‹œ**:
- `memo`: props ë¹„êµ ê¸°ë°˜ ë©”ëª¨ì´ì œì´ì…˜
- `deepMemo`: ê¹Šì€ ë¹„êµ ê¸°ë°˜ ë©”ëª¨ì´ì œì´ì…˜

### 4. ë¹„êµ í•¨ìˆ˜

- **shallowEquals**: 1ë‹¨ê³„ ê¹Šì´ë§Œ ë¹„êµ (ê¸°ë³¸)
- **deepEquals**: ëª¨ë“  ì¤‘ì²© êµ¬ì¡° ë¹„êµ
- **ì»¤ìŠ¤í…€ equals**: ì‚¬ìš©ì ì •ì˜ ë¹„êµ í•¨ìˆ˜

---

## ğŸ”§ êµ¬í˜„ í•¨ìˆ˜ ìƒì„¸

### 1. `useRef<T>(initialValue)`

**ëª©ì **: ë¦¬ë Œë”ë§ ì—†ì´ ê°’ì„ ìœ ì§€í•©ë‹ˆë‹¤.

**êµ¬í˜„**:
```typescript
export const useRef = <T>(initialValue: T): { current: T } => {
  const [ref] = useState(() => ({ current: initialValue }));
  return ref;
};
```

**ìš”ì **:
- useState í™œìš©: ref ê°ì²´ë¥¼ í•œ ë²ˆë§Œ ìƒì„±í•˜ë„ë¡ í•¨
- í•¨ìˆ˜í˜• ì´ˆê¸°ê°’: ì´ˆê¸°í™” í•¨ìˆ˜ë¡œ ref ê°ì²´ ìƒì„±
- ì¬ë Œë”ë§ ë³´ì¡´: ref ê°ì²´ëŠ” ì¬ë Œë”ë§ë˜ì–´ë„ ìœ ì§€ë¨

**ì˜ˆì‹œ**:
```typescript
const ref = useRef(0);
ref.current = 1; // ì¬ë Œë”ë§ ì•ˆ í•¨
```

---

### 2. `useMemo<T>(factory, deps, equals?)`

**ëª©ì **: ê³„ì‚° ê²°ê³¼ë¥¼ ë©”ëª¨ì´ì œì´ì…˜í•©ë‹ˆë‹¤.

**êµ¬í˜„**:
```typescript
export const useMemo = <T>(factory: () => T, deps: DependencyList, equals = shallowEquals): T => {
  const ref = useRef<{ value: T; deps: DependencyList } | null>(null);

  if (!ref.current || !equals(ref.current.deps, deps)) {
    ref.current = { value: factory(), deps };
  }

  return ref.current.value;
};
```

**ìš”ì **:
- useRef í™œìš©: ì´ì „ ì˜ì¡´ì„± ë°°ì—´ê³¼ ê³„ì‚°ëœ ê°’ ì €ì¥
- ì˜ì¡´ì„± ë¹„êµ: `equals` í•¨ìˆ˜ë¡œ ì˜ì¡´ì„± ë¹„êµ
- ì¡°ê±´ë¶€ ì‹¤í–‰: ì˜ì¡´ì„±ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ factory ì‹¤í–‰
- ì»¤ìŠ¤í…€ equals: ê¸°ë³¸ê°’ì€ `shallowEquals`, ì»¤ìŠ¤í…€ ë¹„êµ í•¨ìˆ˜ ì‚¬ìš© ê°€ëŠ¥

**ì˜ˆì‹œ**:
```typescript
const expensiveValue = useMemo(() => {
  return computeExpensiveValue(a, b);
}, [a, b]);
```

---

### 3. `useCallback<T>(callback, deps)`

**ëª©ì **: í•¨ìˆ˜ë¥¼ ë©”ëª¨ì´ì œì´ì…˜í•©ë‹ˆë‹¤.

**êµ¬í˜„**:
```typescript
export const useCallback = <T extends (...args: any[]) => any>(callback: T, deps: DependencyList): T => {
  return useMemo(() => callback, deps);
};
```

**ìš”ì **:
- useMemo í™œìš©: í•¨ìˆ˜ë¥¼ ë©”ëª¨ì´ì œì´ì…˜
- ê°„ë‹¨í•œ êµ¬í˜„: useMemoë¡œ í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” factoryë¡œ ë˜í•‘

**ì˜ˆì‹œ**:
```typescript
const handleClick = useCallback(() => {
  console.log(count);
}, [count]);
```

---

### 4. `useDeepMemo<T>(factory, deps)`

**ëª©ì **: ê¹Šì€ ë¹„êµ ê¸°ë°˜ ë©”ëª¨ì´ì œì´ì…˜ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

**êµ¬í˜„**:
```typescript
export const useDeepMemo = <T>(factory: () => T, deps: DependencyList): T => {
  return useMemo(factory, deps, deepEquals);
};
```

**ìš”ì **:
- useMemo í™œìš©: `deepEquals`ë¥¼ ë¹„êµ í•¨ìˆ˜ë¡œ ì‚¬ìš©
- ê¹Šì€ ë¹„êµ: ì˜ì¡´ì„± ë°°ì—´ì„ ê¹Šê²Œ ë¹„êµ

**ì˜ˆì‹œ**:
```typescript
const value = useDeepMemo(() => {
  return computeValue(obj);
}, [obj]); // obj ë‚´ë¶€ ì†ì„± ë³€ê²½ ê°ì§€
```

---

### 5. `useAutoCallback<T>(fn)`

**ëª©ì **: ìµœì‹  ìƒíƒœë¥¼ ì°¸ì¡°í•˜ë©´ì„œ ì°¸ì¡° ì•ˆì •ì ì¸ ì½œë°±ì„ ìƒì„±í•©ë‹ˆë‹¤.

**êµ¬í˜„**:
```typescript
export const useAutoCallback = <T extends AnyFunction>(fn: T): T => {
  const ref = useRef(fn);

  // í•­ìƒ ìµœì‹  í•¨ìˆ˜ë¡œ ì—…ë°ì´íŠ¸
  ref.current = fn;

  return useCallback((...args: Parameters<T>) => {
    return ref.current(...args);
  }, []) as T;
};
```

**ìš”ì **:
- refë¡œ ìµœì‹  í•¨ìˆ˜ ì €ì¥: í•­ìƒ ìµœì‹  í•¨ìˆ˜ ì°¸ì¡°
- useCallbackìœ¼ë¡œ ì•ˆì •ì  ì°¸ì¡°: ë˜í¼ í•¨ìˆ˜ëŠ” ì¬ìƒì„± ì•ˆ í•¨
- ìë™ ì—…ë°ì´íŠ¸: í•¨ìˆ˜ê°€ ë³€ê²½ë˜ì–´ë„ ìë™ìœ¼ë¡œ ìµœì‹  í•¨ìˆ˜ í˜¸ì¶œ

**ì˜ˆì‹œ**:
```typescript
const handleClick = useAutoCallback(() => {
  console.log(count); // í•­ìƒ ìµœì‹  count ì°¸ì¡°
});
// handleClick ì°¸ì¡°ëŠ” ë³€í•˜ì§€ ì•ŠìŒ
```

---

### 6. `memo<P>(Component, equals?)`

**ëª©ì **: props ë¹„êµ ê¸°ë°˜ ì»´í¬ë„ŒíŠ¸ ë©”ëª¨ì´ì œì´ì…˜ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

**êµ¬í˜„**:
```typescript
export function memo<P extends object>(Component: FunctionComponent<P>, equals = shallowEquals) {
  const MemoizedComponent: FunctionComponent<P> = (props) => {
    const ref = useRef<{ props: P; result: VNode | null } | null>(null);

    if (!ref.current || !equals(ref.current.props, props)) {
      ref.current = { props, result: Component(props) };
    }

    return ref.current.result!;
  };

  MemoizedComponent.displayName = `Memo(${Component.displayName || Component.name})`;

  return MemoizedComponent;
}
```

**ìš”ì **:
- useRef í™œìš©: ì´ì „ propsì™€ ë Œë”ë§ ê²°ê³¼ ì €ì¥
- props ë¹„êµ: `equals` í•¨ìˆ˜ë¡œ props ë¹„êµ
- ì¡°ê±´ë¶€ ë Œë”ë§: propsê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ ì»´í¬ë„ŒíŠ¸ ì¬ì‹¤í–‰
- ì»¤ìŠ¤í…€ equals: ê¸°ë³¸ê°’ì€ `shallowEquals`, ì»¤ìŠ¤í…€ ë¹„êµ í•¨ìˆ˜ ì‚¬ìš© ê°€ëŠ¥

**ì˜ˆì‹œ**:
```typescript
const MemoizedComponent = memo(MyComponent);
// propsê°€ ê°™ìœ¼ë©´ ì¬ë Œë”ë§ ì•ˆ í•¨
```

---

### 7. `deepMemo<P>(Component)`

**ëª©ì **: ê¹Šì€ ë¹„êµ ê¸°ë°˜ ì»´í¬ë„ŒíŠ¸ ë©”ëª¨ì´ì œì´ì…˜ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

**êµ¬í˜„**:
```typescript
export function deepMemo<P extends object>(Component: FunctionComponent<P>) {
  return memo(Component, deepEquals);
}
```

**ìš”ì **:
- memo í™œìš©: `deepEquals`ë¥¼ ë¹„êµ í•¨ìˆ˜ë¡œ ì‚¬ìš©
- ê¹Šì€ ë¹„êµ: propsë¥¼ ê¹Šê²Œ ë¹„êµ

**ì˜ˆì‹œ**:
```typescript
const MemoizedComponent = deepMemo(MyComponent);
// propsë¥¼ ê¹Šê²Œ ë¹„êµí•˜ì—¬ ì¬ë Œë”ë§ ì—¬ë¶€ ê²°ì •
```

---

## ğŸ’¡ í•µì‹¬ ì›ì¹™

### 1. ë©”ëª¨ì´ì œì´ì…˜ íŒ¨í„´

| í›…/HOC        | ëª©ì                               | ë¹„êµ í•¨ìˆ˜              |
| ------------- | --------------------------------- | ---------------------- |
| `useMemo`     | ê°’ ë©”ëª¨ì´ì œì´ì…˜                   | `shallowEquals` (ê¸°ë³¸) |
| `useCallback` | í•¨ìˆ˜ ë©”ëª¨ì´ì œì´ì…˜                 | `shallowEquals` (ê¸°ë³¸) |
| `useDeepMemo` | ê°’ ë©”ëª¨ì´ì œì´ì…˜ (ê¹Šì€ ë¹„êµ)       | `deepEquals`           |
| `memo`        | ì»´í¬ë„ŒíŠ¸ ë©”ëª¨ì´ì œì´ì…˜             | `shallowEquals` (ê¸°ë³¸) |
| `deepMemo`    | ì»´í¬ë„ŒíŠ¸ ë©”ëª¨ì´ì œì´ì…˜ (ê¹Šì€ ë¹„êµ) | `deepEquals`           |

### 2. useRef í™œìš©

- **ìƒíƒœ ì €ì¥**: ì´ì „ ê°’ì´ë‚˜ ê³„ì‚° ê²°ê³¼ ì €ì¥
- **ì¬ë Œë”ë§ ë³´ì¡´**: refëŠ” ì¬ë Œë”ë§ë˜ì–´ë„ ìœ ì§€ë¨
- **í•¨ìˆ˜í˜• ì´ˆê¸°ê°’**: ì´ˆê¸°í™” ì‹œì—ë§Œ ì‹¤í–‰

### 3. ì˜ì¡´ì„± ë¹„êµ

- **shallowEquals**: 1ë‹¨ê³„ ê¹Šì´ë§Œ ë¹„êµ (ê¸°ë³¸)
- **deepEquals**: ëª¨ë“  ì¤‘ì²© êµ¬ì¡° ë¹„êµ
- **ì»¤ìŠ¤í…€ equals**: ì‚¬ìš©ì ì •ì˜ ë¹„êµ í•¨ìˆ˜ ì‚¬ìš© ê°€ëŠ¥

### 4. HOC íŒ¨í„´

- **ì»´í¬ë„ŒíŠ¸ ë˜í•‘**: ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ë¥¼ ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ë¡œ ë˜í•‘
- **props ë¹„êµ**: ì´ì „ propsì™€ í˜„ì¬ props ë¹„êµ
- **ì¡°ê±´ë¶€ ë Œë”ë§**: propsê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ ì¬ë Œë”ë§

---

## ğŸ¯ ì‹¤ìŠµ ì˜ˆì‹œ

### ì˜ˆì‹œ 1: useMemo ë™ì‘

```typescript
// ì²« ë Œë”ë§
const value = useMemo(() => compute(a, b), [a, b]);
  â†’ ref.current = null
  â†’ compute(a, b) ì‹¤í–‰
  â†’ ref.current = { value: result, deps: [a, b] }

// ë‘ ë²ˆì§¸ ë Œë”ë§ (ì˜ì¡´ì„± ë³€ê²½ ì•ˆ ë¨)
const value = useMemo(() => compute(a, b), [a, b]);
  â†’ shallowEquals([a, b], [a, b]) = true
  â†’ compute() ì‹¤í–‰ ì•ˆ í•¨
  â†’ ref.current.value ë°˜í™˜

// ì„¸ ë²ˆì§¸ ë Œë”ë§ (ì˜ì¡´ì„± ë³€ê²½ë¨)
const value = useMemo(() => compute(a, c), [a, c]);
  â†’ shallowEquals([a, b], [a, c]) = false
  â†’ compute(a, c) ì‹¤í–‰
  â†’ ref.current = { value: newResult, deps: [a, c] }
```

### ì˜ˆì‹œ 2: useAutoCallback ë™ì‘

```typescript
// ì²« ë Œë”ë§
const handleClick = useAutoCallback(() => console.log(count));
  â†’ ref.current = fn1
  â†’ useCallbackìœ¼ë¡œ ë˜í¼ ìƒì„±

// ë‘ ë²ˆì§¸ ë Œë”ë§ (count ë³€ê²½)
const handleClick = useAutoCallback(() => console.log(count));
  â†’ ref.current = fn2 (ìµœì‹  í•¨ìˆ˜ë¡œ ì—…ë°ì´íŠ¸)
  â†’ useCallbackì˜ depsëŠ” []ì´ë¯€ë¡œ ë˜í¼ëŠ” ì¬ìƒì„± ì•ˆ ë¨
  â†’ handleClick ì°¸ì¡°ëŠ” ë™ì¼

// í˜¸ì¶œ ì‹œ
handleClick();
  â†’ ref.current(...args) í˜¸ì¶œ
  â†’ í•­ìƒ ìµœì‹  í•¨ìˆ˜(fn2) ì‹¤í–‰
```

### ì˜ˆì‹œ 3: memo ë™ì‘

```typescript
// ì²« ë Œë”ë§
const Memoized = memo(Component);
<Memoized count={1} />
  â†’ ref.current = null
  â†’ Component({ count: 1 }) ì‹¤í–‰
  â†’ ref.current = { props: { count: 1 }, result: vnode }

// ë‘ ë²ˆì§¸ ë Œë”ë§ (props ë³€ê²½ ì•ˆ ë¨)
<Memoized count={1} />
  â†’ shallowEquals({ count: 1 }, { count: 1 }) = true
  â†’ Component() ì‹¤í–‰ ì•ˆ í•¨
  â†’ ref.current.result ë°˜í™˜

// ì„¸ ë²ˆì§¸ ë Œë”ë§ (props ë³€ê²½ë¨)
<Memoized count={2} />
  â†’ shallowEquals({ count: 1 }, { count: 2 }) = false
  â†’ Component({ count: 2 }) ì‹¤í–‰
  â†’ ref.current = { props: { count: 2 }, result: newVnode }
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **useRef ì´ˆê¸°í™”**: í•¨ìˆ˜í˜• ì´ˆê¸°ê°’ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ë§¤ ë Œë”ë§ë§ˆë‹¤ ìƒˆ ê°ì²´ ìƒì„± âŒ
2. **ì˜ì¡´ì„± ëˆ„ë½**: useMemo/useCallbackì—ì„œ ì˜ì¡´ì„± ë°°ì—´ ëˆ„ë½ âŒ
3. **equals í•¨ìˆ˜ ì„ íƒ**: shallowEquals vs deepEquals ì„ íƒ ì‹¤ìˆ˜ âŒ
4. **memo props ë¹„êµ**: propsë¥¼ ì§ì ‘ ë¹„êµí•˜ì§€ ì•Šê³  refì— ì €ì¥ âŒ
5. **useAutoCallback ref ì—…ë°ì´íŠ¸**: ref.currentë¥¼ ì—…ë°ì´íŠ¸ ì•ˆ í•˜ë©´ ìµœì‹  í•¨ìˆ˜ ì°¸ì¡° ì•ˆ ë¨ âŒ

---

## ğŸ’¡ ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜

### 1. useRef ì´ˆê¸°í™” ì‹¤ìˆ˜

```typescript
// âŒ ì˜ëª»ëœ ì˜ˆ
export const useRef = <T>(initialValue: T) => {
  const [ref] = useState({ current: initialValue });  // ë§¤ë²ˆ ìƒˆ ê°ì²´!
  return ref;
};

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
export const useRef = <T>(initialValue: T) => {
  const [ref] = useState(() => ({ current: initialValue }));  // í•¨ìˆ˜í˜• ì´ˆê¸°ê°’
  return ref;
};
```

### 2. ì˜ì¡´ì„± ëˆ„ë½

```typescript
// âŒ ì˜ëª»ëœ ì˜ˆ
const value = useMemo(() => compute(a, b));  // deps ëˆ„ë½!

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
const value = useMemo(() => compute(a, b), [a, b]);  // deps ëª…ì‹œ
```

### 3. equals í•¨ìˆ˜ ì„ íƒ ì‹¤ìˆ˜

```typescript
// âŒ ì˜ëª»ëœ ì˜ˆ
const value = useMemo(() => compute(obj), [obj], deepEquals);  // ì–•ì€ ë¹„êµë©´ ì¶©ë¶„í•œë°!

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
const value = useMemo(() => compute(obj), [obj]);  // shallowEqualsë¡œ ì¶©ë¶„
// ë˜ëŠ”
const value = useDeepMemo(() => compute(obj), [obj]);  // ê¹Šì€ ë¹„êµ í•„ìš” ì‹œ
```

### 4. useAutoCallback ref ì—…ë°ì´íŠ¸ ëˆ„ë½

```typescript
// âŒ ì˜ëª»ëœ ì˜ˆ
export const useAutoCallback = <T>(fn: T) => {
  const ref = useRef(fn);
  // ref.current = fn;  // ì—…ë°ì´íŠ¸ ì•ˆ í•¨!
  return useCallback((...args) => ref.current(...args), []);
};

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
export const useAutoCallback = <T>(fn: T) => {
  const ref = useRef(fn);
  ref.current = fn;  // í•­ìƒ ìµœì‹  í•¨ìˆ˜ë¡œ ì—…ë°ì´íŠ¸
  return useCallback((...args) => ref.current(...args), []);
};
```

---

## ğŸ”„ ë‹¤ìŒ ë‹¨ê³„

ëª¨ë“  ë‹¨ê³„ êµ¬í˜„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰

ì´ì œ Mini-Reactì˜ í•µì‹¬ ê¸°ëŠ¥ì„ ëª¨ë‘ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤:
- âœ… Virtual DOMê³¼ VNode
- âœ… ì»¨í…ìŠ¤íŠ¸ì™€ ë£¨íŠ¸ ì´ˆê¸°í™”
- âœ… DOM ì¸í„°í˜ì´ìŠ¤
- âœ… ë Œë” ìŠ¤ì¼€ì¤„ë§
- âœ… Reconciliation
- âœ… ê¸°ë³¸ Hook ì‹œìŠ¤í…œ
- âœ… í™•ì¥ Hook & HOC

**í…ŒìŠ¤íŠ¸ ì‹¤í–‰**:
```bash
npm test
```

ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•˜ë©´ ì™„ë£Œì…ë‹ˆë‹¤!

