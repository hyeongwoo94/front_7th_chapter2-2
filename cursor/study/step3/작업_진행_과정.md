# ë‹¨ê³„ 3: ì‘ì—… ì§„í–‰ ê³¼ì •

Teacherê°€ ë‹¨ê³„ 3ì„ êµ¬í˜„í•œ ê³¼ì •ì„ ê°„ê²°í•˜ê²Œ ì •ë¦¬í•©ë‹ˆë‹¤.

## ğŸ“‹ ì‘ì—… ìˆœì„œ

1. **ê¸°ì¡´ ì½”ë“œ êµ¬ì¡° íŒŒì•…** â†’ í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ í™•ì¸
2. **DOM ì†ì„± ì„¤ì • í•¨ìˆ˜ êµ¬í˜„** â†’ setDomProps, updateDomProps
3. **DOM ë…¸ë“œ íƒìƒ‰ í•¨ìˆ˜ êµ¬í˜„** â†’ getDomNodes, getFirstDom, getFirstDomFromChildren
4. **DOM ì¡°ì‘ í•¨ìˆ˜ êµ¬í˜„** â†’ insertInstance, removeInstance

---

## ğŸ”§ êµ¬í˜„ ë‚´ìš©

### 1. `setDomProps` (`core/dom.ts`)

**êµ¬í˜„ ìˆœì„œ**:

1. HTMLElement ì²´í¬
2. props ìˆœíšŒ (children ì œì™¸)
3. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì²˜ë¦¬ (`on`ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” props)
4. ìŠ¤íƒ€ì¼ ê°ì²´ ì²˜ë¦¬
5. className â†’ class ë³€í™˜
6. htmlFor â†’ for ë³€í™˜
7. ì¼ë°˜ ì†ì„± ì„¤ì •

**í•µì‹¬ ë¡œì§**:

```typescript
// ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
if (key.startsWith("on") && typeof value === "function") {
  const eventType = key.slice(2).toLowerCase();
  (dom as any)[`__${eventType}Handler`] = value;
  dom.addEventListener(eventType, value);
  continue;
}

// style
if (key === "style" && typeof value === "object" && value !== null) {
  Object.assign((dom as HTMLElement).style, value);
  continue;
}

// className
if (key === "className") {
  dom.setAttribute("class", value);
  continue;
}
```

**í•µì‹¬ í¬ì¸íŠ¸**:

- **ì´ë²¤íŠ¸ëª… ë³€í™˜**: `onClick` â†’ `click` (ì†Œë¬¸ìë¡œ ë³€í™˜)
- **í•¸ë“¤ëŸ¬ ì €ì¥**: `__clickHandler`ë¡œ ì €ì¥í•˜ì—¬ ë‚˜ì¤‘ì— ì œê±°í•  ìˆ˜ ìˆê²Œ í•¨
- **ìŠ¤íƒ€ì¼ ë³‘í•©**: `Object.assign`ìœ¼ë¡œ ìŠ¤íƒ€ì¼ ê°ì²´ ë³‘í•©
- **ì†ì„± ë³€í™˜**: `className` â†’ `class`, `htmlFor` â†’ `for`

---

### 2. `updateDomProps` (`core/dom.ts`)

**êµ¬í˜„ ìˆœì„œ**:

1. ì œê±°ëœ ì†ì„± ì²˜ë¦¬ (prevPropsì—ë§Œ ìˆëŠ” ê²ƒ)
2. ì¶”ê°€/ë³€ê²½ëœ ì†ì„± ì²˜ë¦¬ (nextProps)
3. ë³€ê²½ë˜ì§€ ì•Šì€ ì†ì„±ì€ ê±´ë„ˆë›°ê¸°

**í•µì‹¬ ë¡œì§**:

```typescript
// ì œê±°ëœ ì†ì„±
for (const key in prevProps) {
  if (key === "children") continue;
  if (key in nextProps) continue;  // ì—¬ì „íˆ ìˆìœ¼ë©´ ì œê±° ì•ˆ í•¨
  
  // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì œê±°
  if (key.startsWith("on") && typeof prevProps[key] === "function") {
    const eventType = key.slice(2).toLowerCase();
    const handler = prevProps[key];
    dom.removeEventListener(eventType, handler);
    delete (dom as any)[`__${eventType}Handler`];
  }
  // ... ê¸°íƒ€ ì†ì„± ì œê±°
}

// ì¶”ê°€/ë³€ê²½ëœ ì†ì„±
for (const key in nextProps) {
  if (key === "children") continue;
  if (prevProps[key] === nextProps[key]) continue;  // ë³€ê²½ ì•ˆ ë¨
  
  // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì—…ë°ì´íŠ¸ (ì œê±° í›„ ì¬ë“±ë¡)
  if (key.startsWith("on") && typeof value === "function") {
    const eventType = key.slice(2).toLowerCase();
    const prevHandler = (dom as any)[`__${eventType}Handler`];
    if (prevHandler) {
      dom.removeEventListener(eventType, prevHandler);
    }
    (dom as any)[`__${eventType}Handler`] = value;
    dom.addEventListener(eventType, value);
  }
  // ... ê¸°íƒ€ ì†ì„± ì—…ë°ì´íŠ¸
}
```

**í•µì‹¬ í¬ì¸íŠ¸**:

- **ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì—…ë°ì´íŠ¸**: ê¸°ì¡´ í•¸ë“¤ëŸ¬ ì œê±° í›„ ìƒˆë¡œ ë“±ë¡ (ì°¸ì¡° ë³€ê²½ ëŒ€ì‘)
- **ë³€ê²½ ê°ì§€**: `prevProps[key] === nextProps[key]`ë¡œ ë³€ê²½ ì—¬ë¶€ í™•ì¸
- **ì œê±° ìš°ì„ **: ì œê±°ëœ ì†ì„± ë¨¼ì € ì²˜ë¦¬ í›„ ì¶”ê°€/ë³€ê²½ ì²˜ë¦¬

---

### 3. `getDomNodes` (`core/dom.ts`)

**êµ¬í˜„ ìˆœì„œ**:

1. instanceê°€ nullì´ë©´ ë¹ˆ ë°°ì—´ ë°˜í™˜
2. instance.domì´ ìˆìœ¼ë©´ í¬í•¨
3. instance.children ì¬ê·€ íƒìƒ‰
4. instance.childInstance ì¬ê·€ íƒìƒ‰ (ì»´í¬ë„ŒíŠ¸)

**í•µì‹¬ ë¡œì§**:

```typescript
const nodes: (HTMLElement | Text)[] = [];

// instance.domì´ ìˆìœ¼ë©´ í¬í•¨
if (instance.dom) {
  nodes.push(instance.dom);
}

// instance.children ì¬ê·€ íƒìƒ‰
if (instance.children) {
  for (const child of instance.children) {
    if (child) {
      nodes.push(...getDomNodes(child));
    }
  }
}

// instance.childInstance ì¬ê·€ íƒìƒ‰ (ì»´í¬ë„ŒíŠ¸)
if ((instance as any).childInstance) {
  nodes.push(...getDomNodes((instance as any).childInstance));
}

return nodes;
```

**í•µì‹¬ í¬ì¸íŠ¸**:

- **ì¬ê·€ íƒìƒ‰**: childrenê³¼ childInstanceë¥¼ ì¬ê·€ì ìœ¼ë¡œ íƒìƒ‰
- **Fragment ì²˜ë¦¬**: FragmentëŠ” domì´ nullì´ë¯€ë¡œ ìì‹ë§Œ íƒìƒ‰
- **ì»´í¬ë„ŒíŠ¸ ì²˜ë¦¬**: childInstanceë„ ì¬ê·€ì ìœ¼ë¡œ íƒìƒ‰

---

### 4. `getFirstDom` (`core/dom.ts`)

**êµ¬í˜„ ìˆœì„œ**:

1. instanceê°€ nullì´ë©´ null ë°˜í™˜
2. instance.domì´ ìˆìœ¼ë©´ ë°˜í™˜
3. instance.childrenì—ì„œ ì²« DOM ì°¾ê¸°
4. instance.childInstanceì—ì„œ ì²« DOM ì°¾ê¸°

**í•µì‹¬ ë¡œì§**:

```typescript
// instance.dom ìˆìœ¼ë©´ ë°˜í™˜
if (instance.dom) {
  return instance.dom;
}

// instance.childrenì—ì„œ ì²« DOM ì°¾ê¸°
if (instance.children) {
  for (const child of instance.children) {
    if (child) {
      const dom = getFirstDom(child);
      if (dom) return dom;  // ì²« ë²ˆì§¸ë¡œ ë°œê²¬ëœ DOM ë°˜í™˜
    }
  }
}

// instance.childInstanceì—ì„œ ì²« DOM ì°¾ê¸° (ì»´í¬ë„ŒíŠ¸)
if ((instance as any).childInstance) {
  return getFirstDom((instance as any).childInstance);
}

return null;
```

**í•µì‹¬ í¬ì¸íŠ¸**:

- **ìš°ì„ ìˆœìœ„**: dom â†’ children â†’ childInstance
- **ì²« ë²ˆì§¸ë§Œ**: ì²« ë²ˆì§¸ë¡œ ë°œê²¬ëœ DOMë§Œ ë°˜í™˜
- **ì¬ê·€ íƒìƒ‰**: ìì‹ì—ì„œë„ ì²« ë²ˆì§¸ DOMë§Œ ì°¾ìŒ

---

### 5. `getFirstDomFromChildren` (`core/dom.ts`)

**êµ¬í˜„ ìˆœì„œ**:

1. childrenì´ ì—†ìœ¼ë©´ null ë°˜í™˜
2. ê° childì—ì„œ `getFirstDom` í˜¸ì¶œ
3. ì²« ë²ˆì§¸ë¡œ ë°œê²¬ëœ DOM ë°˜í™˜

**í•µì‹¬ ë¡œì§**:

```typescript
if (!children) return null;

for (const child of children) {
  if (child) {
    const dom = getFirstDom(child);
    if (dom) return dom;  // ì²« ë²ˆì§¸ë¡œ ë°œê²¬ëœ DOM ë°˜í™˜
  }
}

return null;
```

**ìš”ì **:

- ê° ìì‹ì—ì„œ ì²« DOM ì°¾ê¸°
- ì²« ë²ˆì§¸ë¡œ ë°œê²¬ëœ DOM ë°˜í™˜
- `getFirstDom` ì¬ì‚¬ìš©

---

### 6. `insertInstance` (`core/dom.ts`)

**êµ¬í˜„ ìˆœì„œ**:

1. instanceê°€ nullì´ë©´ ì•„ë¬´ ì‘ì—… ì—†ìŒ
2. `getDomNodes`ë¡œ ëª¨ë“  DOM ë…¸ë“œ ê°€ì ¸ì˜¤ê¸°
3. anchorê°€ ìˆìœ¼ë©´ `insertBefore`, ì—†ìœ¼ë©´ `appendChild`
4. ëª¨ë“  DOM ë…¸ë“œë¥¼ ìˆœì„œëŒ€ë¡œ ì‚½ì…

**í•µì‹¬ ë¡œì§**:

```typescript
if (!instance) return;

const nodes = getDomNodes(instance);

for (const node of nodes) {
  if (anchor) {
    parentDom.insertBefore(node, anchor);
  } else {
    parentDom.appendChild(node);
  }
}
```

**í•µì‹¬ í¬ì¸íŠ¸**:

- **DOM ë…¸ë“œ ìˆœì„œ**: `getDomNodes`ë¡œ ì–»ì€ ìˆœì„œëŒ€ë¡œ ì‚½ì…
- **anchor ì²˜ë¦¬**: anchorê°€ ìˆìœ¼ë©´ ê·¸ ì•ì— ì‚½ì…
- **ëª¨ë“  ë…¸ë“œ ì‚½ì…**: Fragmentë‚˜ ì»´í¬ë„ŒíŠ¸ëŠ” ì—¬ëŸ¬ DOM ë…¸ë“œë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŒ

---

### 7. `removeInstance` (`core/dom.ts`)

**êµ¬í˜„ ìˆœì„œ**:

1. instanceê°€ nullì´ë©´ ì•„ë¬´ ì‘ì—… ì—†ìŒ
2. `getDomNodes`ë¡œ ëª¨ë“  DOM ë…¸ë“œ ê°€ì ¸ì˜¤ê¸°
3. ì—­ìˆœìœ¼ë¡œ ì œê±° (ì¸ë±ìŠ¤ ì˜¤ë¥˜ ë°©ì§€)
4. ë¶€ëª¨ê°€ ë§ëŠ” ê²½ìš°ì—ë§Œ ì œê±°

**í•µì‹¬ ë¡œì§**:

```typescript
if (!instance) return;

const nodes = getDomNodes(instance);

// ì—­ìˆœìœ¼ë¡œ ì œê±° (ì¸ë±ìŠ¤ ì˜¤ë¥˜ ë°©ì§€)
for (let i = nodes.length - 1; i >= 0; i--) {
  const node = nodes[i];
  if (node.parentNode === parentDom) {
    parentDom.removeChild(node);
  }
}
```

**í•µì‹¬ í¬ì¸íŠ¸**:

- **ì—­ìˆœ ì œê±°**: DOM ìˆœì„œê°€ ë³€ê²½ë˜ì–´ë„ ì¸ë±ìŠ¤ ì˜¤ë¥˜ ë°©ì§€
- **ë¶€ëª¨ í™•ì¸**: `node.parentNode === parentDom`ìœ¼ë¡œ í™•ì¸
- **ëª¨ë“  ë…¸ë“œ ì œê±°**: Fragmentë‚˜ ì»´í¬ë„ŒíŠ¸ëŠ” ì—¬ëŸ¬ DOM ë…¸ë“œë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŒ

---

## âœ… í…ŒìŠ¤íŠ¸ í™•ì¸

ì´ ë‹¨ê³„ë§Œìœ¼ë¡œëŠ” ë…ë¦½ì ì¸ í…ŒìŠ¤íŠ¸ê°€ ì—†ìŒ. ë‹¤ìŒ ë‹¨ê³„(Reconciliation)ì™€ í•¨ê»˜ í…ŒìŠ¤íŠ¸ í†µê³¼.

**í™•ì¸ ì‚¬í•­**:

- `setDomProps`ê°€ ì˜¬ë°”ë¥´ê²Œ ì†ì„±ì„ ì„¤ì •í•˜ëŠ”ì§€
- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì˜¬ë°”ë¥´ê²Œ ë“±ë¡ë˜ëŠ”ì§€
- `updateDomProps`ê°€ ë³€ê²½ì‚¬í•­ë§Œ ì—…ë°ì´íŠ¸í•˜ëŠ”ì§€
- `getDomNodes`ê°€ ëª¨ë“  DOM ë…¸ë“œë¥¼ ì°¾ëŠ”ì§€
- `removeInstance`ê°€ ì˜¬ë°”ë¥´ê²Œ ì œê±°í•˜ëŠ”ì§€

---

## ğŸ¯ í•µì‹¬ ì›ì¹™

### 1. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ê´€ë¦¬

- **ë“±ë¡**: `addEventListener`ë¡œ ë“±ë¡í•˜ê³  `__handler`ë¡œ ì €ì¥
- **ì œê±°**: ì €ì¥ëœ í•¸ë“¤ëŸ¬ë¥¼ `removeEventListener`ë¡œ ì œê±°
- **ì—…ë°ì´íŠ¸**: ê¸°ì¡´ í•¸ë“¤ëŸ¬ ì œê±° í›„ ìƒˆë¡œ ë“±ë¡ (ì°¸ì¡° ë³€ê²½ ëŒ€ì‘)

### 2. ì†ì„± ë³€í™˜

| React Prop | DOM Attribute |
|-----------|---------------|
| `className` | `class` |
| `htmlFor` | `for` |
| `onClick` | `click` (ì´ë²¤íŠ¸) |

### 3. DOM ë…¸ë“œ íƒìƒ‰ ìš°ì„ ìˆœìœ„

1. `instance.dom` (ì§ì ‘ DOM)
2. `instance.children` (ìì‹ ì¸ìŠ¤í„´ìŠ¤ë“¤)
3. `instance.childInstance` (ì»´í¬ë„ŒíŠ¸ì˜ ìì‹)

### 4. Fragment ì²˜ë¦¬

- FragmentëŠ” `dom` ì†ì„±ì´ null
- ìì‹ë§Œ íƒìƒ‰í•˜ì—¬ DOM ë…¸ë“œ ë°˜í™˜
- FragmentëŠ” ì—¬ëŸ¬ DOM ë…¸ë“œë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŒ

### 5. DOM ì¡°ì‘ ìˆœì„œ

- **ì‚½ì…**: ìˆœì„œëŒ€ë¡œ ì‚½ì… (ì •ìˆœ)
- **ì œê±°**: ì—­ìˆœìœ¼ë¡œ ì œê±° (ì¸ë±ìŠ¤ ì˜¤ë¥˜ ë°©ì§€)

---

## ğŸ“š í•™ìŠµ ìš”ì•½

### ì´ë²¤íŠ¸ëª… ë³€í™˜ ê·œì¹™

```typescript
onClick â†’ click
onChange â†’ change
onMouseEnter â†’ mouseenter
// ì²« ë¬¸ìëŠ” ì†Œë¬¸ìë¡œ ë³€í™˜
```

### ìŠ¤íƒ€ì¼ ì²˜ë¦¬

```typescript
// ê°ì²´ë¡œ ì „ë‹¬
style: { color: 'red', fontSize: '14px' }
â†’ Object.assign(dom.style, { color: 'red', fontSize: '14px' })

// DOMì—ì„œëŠ” camelCase ì‚¬ìš©
dom.style.fontSize = '14px'
```

### DOM ë…¸ë“œ íƒìƒ‰

| í•¨ìˆ˜ | ëª©ì  | ë°˜í™˜ |
|------|------|------|
| `getDomNodes` | ëª¨ë“  DOM ë…¸ë“œ | `(HTMLElement \| Text)[]` |
| `getFirstDom` | ì²« ë²ˆì§¸ DOM | `HTMLElement \| Text \| null` |
| `getFirstDomFromChildren` | ìì‹ì—ì„œ ì²« DOM | `HTMLElement \| Text \| null` |

### ì†ì„± ì—…ë°ì´íŠ¸ ìµœì í™”

```typescript
// ë³€ê²½ë˜ì§€ ì•Šì€ ì†ì„±ì€ ê±´ë„ˆë›°ê¸°
if (prevProps[key] === nextProps[key]) continue;

// ì œê±°ëœ ì†ì„±ë§Œ ì²˜ë¦¬
if (key in nextProps) continue;  // ì•„ì§ ìˆìœ¼ë©´ ì œê±° ì•ˆ í•¨
```

---

## ğŸ’¡ ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜

1. **ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì œê±° ëˆ„ë½**: ì—…ë°ì´íŠ¸ ì‹œ ê¸°ì¡´ í•¸ë“¤ëŸ¬ ì œê±° ì•ˆ í•¨ âŒ
2. **ìˆœì„œ ë¬¸ì œ**: removeInstanceì—ì„œ ì •ìˆœìœ¼ë¡œ ì œê±°í•˜ì—¬ ì¸ë±ìŠ¤ ì˜¤ë¥˜ ë°œìƒ âŒ
3. **ë¶€ëª¨ í™•ì¸ ëˆ„ë½**: removeInstanceì—ì„œ ë¶€ëª¨ í™•ì¸ ì•ˆ í•¨ âŒ
4. **Fragment ì²˜ë¦¬ ëˆ„ë½**: Fragmentì˜ domì´ nullì¸ ê²½ìš° ì²˜ë¦¬ ì•ˆ í•¨ âŒ
5. **ì†ì„± ë³€í™˜ ëˆ„ë½**: classNameì„ classë¡œ ë³€í™˜ ì•ˆ í•¨ âŒ

---

## ğŸ” êµ¬í˜„ ìƒì„¸

### ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì €ì¥ íŒ¨í„´

```typescript
// ì €ì¥
(dom as any)[`__${eventType}Handler`] = value;
dom.addEventListener(eventType, value);

// ì œê±°
const handler = (dom as any)[`__${eventType}Handler`];
dom.removeEventListener(eventType, handler);
delete (dom as any)[`__${eventType}Handler`];
```

**ì´ìœ **: ë‚˜ì¤‘ì— ì œê±°í•  ë•Œ ê°™ì€ í•¸ë“¤ëŸ¬ ì°¸ì¡°ë¥¼ ì°¾ê¸° ìœ„í•´ ì €ì¥

### ì—­ìˆœ ì œê±° ì´ìœ 

```typescript
// ì •ìˆœìœ¼ë¡œ ì œê±° (ë¬¸ì œ ìˆìŒ)
for (let i = 0; i < nodes.length; i++) {
  parentDom.removeChild(nodes[i]);  // ì¸ë±ìŠ¤ê°€ ë³€ê²½ë  ìˆ˜ ìˆìŒ
}

// ì—­ìˆœìœ¼ë¡œ ì œê±° (ì•ˆì „)
for (let i = nodes.length - 1; i >= 0; i--) {
  parentDom.removeChild(nodes[i]);  // ë§ˆì§€ë§‰ë¶€í„° ì œê±°í•˜ë¯€ë¡œ ì•ˆì „
}
```

**ì´ìœ **: DOMì—ì„œ ì œê±°í•˜ë©´ ë°°ì—´ ì¸ë±ìŠ¤ê°€ ë³€ê²½ë  ìˆ˜ ìˆìŒ

---

ë‹¤ìŒ ë‹¨ê³„: **ë‹¨ê³„ 4 - ë Œë” ìŠ¤ì¼€ì¤„ë§**

