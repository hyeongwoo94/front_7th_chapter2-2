# ë‹¨ê³„ 3: DOM ì¸í„°í˜ì´ìŠ¤ - í•™ìŠµ ë‚´ìš©

ì´ ë¬¸ì„œëŠ” ë‹¨ê³„ 3ì—ì„œ í•™ìŠµí•´ì•¼ í•  í•µì‹¬ ê°œë…ê³¼ êµ¬í˜„ ë‚´ìš©ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ“š í•µì‹¬ ê°œë…

### 1. DOM ì†ì„± ì„¤ì •

ReactëŠ” JSX propsë¥¼ ì‹¤ì œ DOM ì†ì„±ìœ¼ë¡œ ë³€í™˜í•´ì•¼ í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ì—¬ëŸ¬ ë³€í™˜ì´ í•„ìš”í•©ë‹ˆë‹¤:

- **ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬**: `onClick` â†’ `click` ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
- **ìŠ¤íƒ€ì¼**: ê°ì²´ í˜•íƒœì˜ ìŠ¤íƒ€ì¼ì„ DOM style ì†ì„±ì— ë³‘í•©
- **íŠ¹ìˆ˜ ì†ì„±**: `className` â†’ `class`, `htmlFor` â†’ `for`
- **ì¼ë°˜ ì†ì„±**: id, type, value ë“± ì§ì ‘ ì„¤ì •

### 2. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ê´€ë¦¬

ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ëŠ” ë‚˜ì¤‘ì— ì œê±°í•  ìˆ˜ ìˆë„ë¡ ì €ì¥í•´ì•¼ í•©ë‹ˆë‹¤:

```typescript
// ë“±ë¡
(dom as any)[`__${eventType}Handler`] = value;
dom.addEventListener(eventType, value);

// ì œê±°
const handler = (dom as any)[`__${eventType}Handler`];
dom.removeEventListener(eventType, handler);
```

**ì´ìœ **: ì—…ë°ì´íŠ¸ ì‹œ ì´ì „ í•¸ë“¤ëŸ¬ë¥¼ ì œê±°í•˜ê³  ìƒˆ í•¸ë“¤ëŸ¬ë¥¼ ë“±ë¡í•´ì•¼ í•¨

### 3. DOM ë…¸ë“œ íƒìƒ‰

InstanceëŠ” ì—¬ëŸ¬ DOM ë…¸ë“œë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (Fragment, ì»´í¬ë„ŒíŠ¸):

- **getDomNodes**: ëª¨ë“  DOM ë…¸ë“œë¥¼ ì¬ê·€ì ìœ¼ë¡œ ì°¾ê¸°
- **getFirstDom**: ì²« ë²ˆì§¸ DOM ë…¸ë“œë§Œ ì°¾ê¸°
- **getFirstDomFromChildren**: ìì‹ ì¸ìŠ¤í„´ìŠ¤ë“¤ì—ì„œ ì²« DOM ì°¾ê¸°

**ìš°ì„ ìˆœìœ„**:
1. `instance.dom` (ì§ì ‘ DOM)
2. `instance.children` (ìì‹ ì¸ìŠ¤í„´ìŠ¤ë“¤)
3. `instance.childInstance` (ì»´í¬ë„ŒíŠ¸ì˜ ìì‹)

### 4. DOM ì¡°ì‘ ìˆœì„œ

- **ì‚½ì…**: ìˆœì„œëŒ€ë¡œ ì‚½ì… (ì •ìˆœ)
- **ì œê±°**: ì—­ìˆœìœ¼ë¡œ ì œê±° (ì¸ë±ìŠ¤ ì˜¤ë¥˜ ë°©ì§€)

---

## ğŸ”§ êµ¬í˜„ í•¨ìˆ˜ ìƒì„¸

### 1. `setDomProps(dom, props)`

**ëª©ì **: DOM ìš”ì†Œì— ì†ì„±ì„ ì„¤ì •í•©ë‹ˆë‹¤.

**ì²˜ë¦¬ ìˆœì„œ**:
1. HTMLElement ì²´í¬
2. props ìˆœíšŒ (children ì œì™¸)
3. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì²˜ë¦¬
4. ìŠ¤íƒ€ì¼ ê°ì²´ ì²˜ë¦¬
5. className â†’ class ë³€í™˜
6. htmlFor â†’ for ë³€í™˜
7. ì¼ë°˜ ì†ì„± ì„¤ì •

**í•µì‹¬ ë¡œì§**:
```typescript
// ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
if (key.startsWith("on") && typeof value === "function") {
  const eventType = key.slice(2).toLowerCase();
  (dom as any)[`__${eventType}Handler`] = value;
  dom.addEventListener(eventType, value);
  continue;
}

// ìŠ¤íƒ€ì¼
if (key === "style" && typeof value === "object" && value !== null) {
  Object.assign((dom as HTMLElement).style, value);
  continue;
}

// className
if (key === "className") {
  dom.setAttribute("class", value);
  continue;
}
```

**ìš”ì **:
- ì´ë²¤íŠ¸ëª… ë³€í™˜: `onClick` â†’ `click` (ì†Œë¬¸ì)
- í•¸ë“¤ëŸ¬ ì €ì¥: ë‚˜ì¤‘ì— ì œê±°í•˜ê¸° ìœ„í•´ ì €ì¥
- ìŠ¤íƒ€ì¼ ë³‘í•©: `Object.assign`ìœ¼ë¡œ ë³‘í•©

---

### 2. `updateDomProps(dom, prevProps, nextProps)`

**ëª©ì **: ë³€ê²½ëœ ì†ì„±ë§Œ íš¨ìœ¨ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

**ì²˜ë¦¬ ìˆœì„œ**:
1. ì œê±°ëœ ì†ì„± ì²˜ë¦¬ (prevPropsì—ë§Œ ìˆëŠ” ê²ƒ)
2. ì¶”ê°€/ë³€ê²½ëœ ì†ì„± ì²˜ë¦¬ (nextProps)
3. ë³€ê²½ë˜ì§€ ì•Šì€ ì†ì„±ì€ ê±´ë„ˆë›°ê¸°

**í•µì‹¬ ë¡œì§**:
```typescript
// ì œê±°ëœ ì†ì„±
for (const key in prevProps) {
  if (key === "children") continue;
  if (key in nextProps) continue;  // ì—¬ì „íˆ ìˆìœ¼ë©´ ì œê±° ì•ˆ í•¨
  
  // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì œê±°
  if (key.startsWith("on") && typeof prevProps[key] === "function") {
    const eventType = key.slice(2).toLowerCase();
    const handler = prevProps[key];
    dom.removeEventListener(eventType, handler);
    delete (dom as any)[`__${eventType}Handler`];
  }
}

// ì¶”ê°€/ë³€ê²½ëœ ì†ì„±
for (const key in nextProps) {
  if (key === "children") continue;
  if (prevProps[key] === nextProps[key]) continue;  // ë³€ê²½ ì•ˆ ë¨
  
  // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì—…ë°ì´íŠ¸
  if (key.startsWith("on") && typeof value === "function") {
    const eventType = key.slice(2).toLowerCase();
    const prevHandler = (dom as any)[`__${eventType}Handler`];
    if (prevHandler) {
      dom.removeEventListener(eventType, prevHandler);
    }
    (dom as any)[`__${eventType}Handler`] = value;
    dom.addEventListener(eventType, value);
  }
}
```

**ìš”ì **:
- ë³€ê²½ ê°ì§€: `prevProps[key] === nextProps[key]`ë¡œ í™•ì¸
- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì—…ë°ì´íŠ¸: ê¸°ì¡´ ì œê±° í›„ ìƒˆë¡œ ë“±ë¡
- ì œê±° ìš°ì„ : ì œê±°ëœ ì†ì„± ë¨¼ì € ì²˜ë¦¬

---

### 3. `getDomNodes(instance)`

**ëª©ì **: ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ëª¨ë“  DOM ë…¸ë“œë¥¼ ì¬ê·€ì ìœ¼ë¡œ ì°¾ìŠµë‹ˆë‹¤.

**êµ¬í˜„**:
```typescript
const nodes: (HTMLElement | Text)[] = [];

// instance.domì´ ìˆìœ¼ë©´ í¬í•¨
if (instance.dom) {
  nodes.push(instance.dom);
}

// instance.children ì¬ê·€ íƒìƒ‰
if (instance.children) {
  for (const child of instance.children) {
    if (child) {
      nodes.push(...getDomNodes(child));
    }
  }
}

// instance.childInstance ì¬ê·€ íƒìƒ‰ (ì»´í¬ë„ŒíŠ¸)
if ((instance as any).childInstance) {
  nodes.push(...getDomNodes((instance as any).childInstance));
}

return nodes;
```

**ìš”ì **:
- ì¬ê·€ íƒìƒ‰: childrenê³¼ childInstanceë¥¼ ì¬ê·€ì ìœ¼ë¡œ íƒìƒ‰
- Fragment ì²˜ë¦¬: FragmentëŠ” domì´ nullì´ë¯€ë¡œ ìì‹ë§Œ íƒìƒ‰

---

### 4. `getFirstDom(instance)`

**ëª©ì **: ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì²« ë²ˆì§¸ DOM ë…¸ë“œë§Œ ì°¾ìŠµë‹ˆë‹¤.

**êµ¬í˜„**:
```typescript
// instance.dom ìˆìœ¼ë©´ ë°˜í™˜
if (instance.dom) {
  return instance.dom;
}

// instance.childrenì—ì„œ ì²« DOM ì°¾ê¸°
if (instance.children) {
  for (const child of instance.children) {
    if (child) {
      const dom = getFirstDom(child);
      if (dom) return dom;  // ì²« ë²ˆì§¸ë¡œ ë°œê²¬ëœ DOM ë°˜í™˜
    }
  }
}

// instance.childInstanceì—ì„œ ì²« DOM ì°¾ê¸° (ì»´í¬ë„ŒíŠ¸)
if ((instance as any).childInstance) {
  return getFirstDom((instance as any).childInstance);
}

return null;
```

**ìš”ì **:
- ìš°ì„ ìˆœìœ„: dom â†’ children â†’ childInstance
- ì²« ë²ˆì§¸ë§Œ: ì²« ë²ˆì§¸ë¡œ ë°œê²¬ëœ DOMë§Œ ë°˜í™˜

---

### 5. `getFirstDomFromChildren(children)`

**ëª©ì **: ìì‹ ì¸ìŠ¤í„´ìŠ¤ë“¤ì—ì„œ ì²« ë²ˆì§¸ DOMì„ ì°¾ìŠµë‹ˆë‹¤.

**êµ¬í˜„**:
```typescript
if (!children) return null;

for (const child of children) {
  if (child) {
    const dom = getFirstDom(child);
    if (dom) return dom;  // ì²« ë²ˆì§¸ë¡œ ë°œê²¬ëœ DOM ë°˜í™˜
  }
}

return null;
```

**ìš”ì **:
- `getFirstDom` ì¬ì‚¬ìš©
- ì²« ë²ˆì§¸ë¡œ ë°œê²¬ëœ DOM ë°˜í™˜

---

### 6. `insertInstance(parentDom, instance, anchor)`

**ëª©ì **: ì¸ìŠ¤í„´ìŠ¤ì˜ ëª¨ë“  DOM ë…¸ë“œë¥¼ ë¶€ëª¨ì— ì‚½ì…í•©ë‹ˆë‹¤.

**êµ¬í˜„**:
```typescript
if (!instance) return;

const nodes = getDomNodes(instance);

for (const node of nodes) {
  if (anchor) {
    parentDom.insertBefore(node, anchor);
  } else {
    parentDom.appendChild(node);
  }
}
```

**ìš”ì **:
- ëª¨ë“  ë…¸ë“œ ì‚½ì…: Fragmentë‚˜ ì»´í¬ë„ŒíŠ¸ëŠ” ì—¬ëŸ¬ DOM ë…¸ë“œë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŒ
- anchor ì²˜ë¦¬: anchorê°€ ìˆìœ¼ë©´ ê·¸ ì•ì— ì‚½ì…

---

### 7. `removeInstance(parentDom, instance)`

**ëª©ì **: ì¸ìŠ¤í„´ìŠ¤ì˜ ëª¨ë“  DOM ë…¸ë“œë¥¼ ë¶€ëª¨ì—ì„œ ì œê±°í•©ë‹ˆë‹¤.

**êµ¬í˜„**:
```typescript
if (!instance) return;

const nodes = getDomNodes(instance);

// ì—­ìˆœìœ¼ë¡œ ì œê±° (ì¸ë±ìŠ¤ ì˜¤ë¥˜ ë°©ì§€)
for (let i = nodes.length - 1; i >= 0; i--) {
  const node = nodes[i];
  if (node.parentNode === parentDom) {
    parentDom.removeChild(node);
  }
}
```

**ìš”ì **:
- ì—­ìˆœ ì œê±°: DOM ìˆœì„œê°€ ë³€ê²½ë˜ì–´ë„ ì¸ë±ìŠ¤ ì˜¤ë¥˜ ë°©ì§€
- ë¶€ëª¨ í™•ì¸: `node.parentNode === parentDom`ìœ¼ë¡œ í™•ì¸

---

## ğŸ’¡ í•µì‹¬ ì›ì¹™

### 1. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ê´€ë¦¬

- **ë“±ë¡**: `addEventListener`ë¡œ ë“±ë¡í•˜ê³  `__handler`ë¡œ ì €ì¥
- **ì œê±°**: ì €ì¥ëœ í•¸ë“¤ëŸ¬ë¥¼ `removeEventListener`ë¡œ ì œê±°
- **ì—…ë°ì´íŠ¸**: ê¸°ì¡´ í•¸ë“¤ëŸ¬ ì œê±° í›„ ìƒˆë¡œ ë“±ë¡ (ì°¸ì¡° ë³€ê²½ ëŒ€ì‘)

### 2. ì†ì„± ë³€í™˜

| React Prop | DOM Attribute |
|-----------|---------------|
| `className` | `class` |
| `htmlFor` | `for` |
| `onClick` | `click` (ì´ë²¤íŠ¸) |

### 3. DOM ë…¸ë“œ íƒìƒ‰ ìš°ì„ ìˆœìœ„

1. `instance.dom` (ì§ì ‘ DOM)
2. `instance.children` (ìì‹ ì¸ìŠ¤í„´ìŠ¤ë“¤)
3. `instance.childInstance` (ì»´í¬ë„ŒíŠ¸ì˜ ìì‹)

### 4. Fragment ì²˜ë¦¬

- FragmentëŠ” `dom` ì†ì„±ì´ null
- ìì‹ë§Œ íƒìƒ‰í•˜ì—¬ DOM ë…¸ë“œ ë°˜í™˜
- FragmentëŠ” ì—¬ëŸ¬ DOM ë…¸ë“œë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŒ

### 5. DOM ì¡°ì‘ ìˆœì„œ

- **ì‚½ì…**: ìˆœì„œëŒ€ë¡œ ì‚½ì… (ì •ìˆœ)
- **ì œê±°**: ì—­ìˆœìœ¼ë¡œ ì œê±° (ì¸ë±ìŠ¤ ì˜¤ë¥˜ ë°©ì§€)

---

## ğŸ¯ ì‹¤ìŠµ ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡

```typescript
const dom = document.createElement("button");
setDomProps(dom, {
  onClick: () => console.log("clicked"),
  className: "btn",
  style: { color: "red" }
});

// ê²°ê³¼:
// - click ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
// - class="btn" ì„¤ì •
// - style.color = "red" ì„¤ì •
```

### ì˜ˆì‹œ 2: ì†ì„± ì—…ë°ì´íŠ¸

```typescript
const dom = document.createElement("div");
setDomProps(dom, { className: "old" });
updateDomProps(dom, { className: "old" }, { className: "new" });

// ê²°ê³¼:
// - class="new"ë¡œ ë³€ê²½
```

### ì˜ˆì‹œ 3: DOM ë…¸ë“œ íƒìƒ‰

```typescript
// Fragment ì¸ìŠ¤í„´ìŠ¤
const fragmentInstance = {
  kind: NodeTypes.FRAGMENT,
  dom: null,
  children: [
    { dom: div1, ... },
    { dom: div2, ... }
  ]
};

getDomNodes(fragmentInstance);
// â†’ [div1, div2]

getFirstDom(fragmentInstance);
// â†’ div1
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì œê±° ëˆ„ë½**: ì—…ë°ì´íŠ¸ ì‹œ ê¸°ì¡´ í•¸ë“¤ëŸ¬ ì œê±° ì•ˆ í•¨ âŒ
2. **ìˆœì„œ ë¬¸ì œ**: removeInstanceì—ì„œ ì •ìˆœìœ¼ë¡œ ì œê±°í•˜ì—¬ ì¸ë±ìŠ¤ ì˜¤ë¥˜ ë°œìƒ âŒ
3. **ë¶€ëª¨ í™•ì¸ ëˆ„ë½**: removeInstanceì—ì„œ ë¶€ëª¨ í™•ì¸ ì•ˆ í•¨ âŒ
4. **Fragment ì²˜ë¦¬ ëˆ„ë½**: Fragmentì˜ domì´ nullì¸ ê²½ìš° ì²˜ë¦¬ ì•ˆ í•¨ âŒ
5. **ì†ì„± ë³€í™˜ ëˆ„ë½**: classNameì„ classë¡œ ë³€í™˜ ì•ˆ í•¨ âŒ

---

## ğŸ’¡ ìì£¼ í•˜ëŠ” ì‹¤ìˆ˜

### 1. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì €ì¥ ëˆ„ë½

```typescript
// âŒ ì˜ëª»ëœ ì˜ˆ
dom.addEventListener(eventType, value);
// ë‚˜ì¤‘ì— ì œê±°í•  ìˆ˜ ì—†ìŒ!

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
(dom as any)[`__${eventType}Handler`] = value;
dom.addEventListener(eventType, value);
```

### 2. ì—­ìˆœ ì œê±° ëˆ„ë½

```typescript
// âŒ ì˜ëª»ëœ ì˜ˆ
for (let i = 0; i < nodes.length; i++) {
  parentDom.removeChild(nodes[i]);  // ì¸ë±ìŠ¤ ì˜¤ë¥˜ ê°€ëŠ¥!
}

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
for (let i = nodes.length - 1; i >= 0; i--) {
  parentDom.removeChild(nodes[i]);  // ì•ˆì „
}
```

### 3. ì´ë²¤íŠ¸ëª… ë³€í™˜ ì‹¤ìˆ˜

```typescript
// âŒ ì˜ëª»ëœ ì˜ˆ
const eventType = key.slice(2);  // "Click" (ëŒ€ë¬¸ì)

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
const eventType = key.slice(2).toLowerCase();  // "click"
```

---

## ğŸ”„ ë‹¤ìŒ ë‹¨ê³„

ì´ì œ DOM ì¸í„°í˜ì´ìŠ¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ì—ì„œëŠ” ë Œë” ìŠ¤ì¼€ì¤„ë§ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

**ë‹¤ìŒ ë‹¨ê³„**: [ë‹¨ê³„ 4 - ë Œë” ìŠ¤ì¼€ì¤„ë§](../step4/í•™ìŠµ_ë‚´ìš©.md)

